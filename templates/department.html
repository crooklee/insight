 {% extends 'layout.html' %}
{%block active%}
<script>
$("#departments").attr('class','active');
</script>
{%end%}

{% block content %}

 <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
 <div class="row">
 <h4 class="sub-header"><strong>职能委办配置</strong></h4>
          <div class="table-responsive">
            <table class="table table-striped table-hover">
              <thead>
                <tr>                  
                  <th>名称</th>
                  <th>联系人</th>
                  <th>联系方式</th>
                  <th>ID</th>
                  <th>设置</th>
                </tr>
              </thead>
              <tbody>

              {% for d in departments%}
                <tr>                  
                  <td>{{d.name}}</td>
                  <td>{{d.person}}</td>
                  <td>                     
                      <span><img src="/static/image/telephone.svg" style="height:16px;">: {{d.phone}}  | </span> 
                      <span><img src="/static/image/mobile.svg" style="height:16px;">: {{d.mobile}}  | </span> 
                      <span><img src="/static/image/mail.svg" style="height:16px;">: {{d.email}}   </span>                                                               
                  </td>
                  <td>{{d.id}}</td>
                  <td>
                      <input class="btn btn-info btn-xs" type="button"  data-toggle="modal" data-target="#setupModal" data-id="{{d.id}}" data-name="{{d.name}}" data-person="{{d.person}}" data-phone="{{d.phone}}" data-mobile="{{d.mobile}}"  data-email="{{d.email}}" value="设置">                      
                      <input class="btn btn-danger btn-xs" type="button" value="删除" data-toggle="modal" data-target="#rmModal" data-id="{{d.id}}">
                  </td>
                </tr>
              {%end%}
              </tbody>
            </table>
             <input class="btn btn-primary" type="button" data-toggle="modal" data-target="#addModal" value="增加">                   
              <!-- addModal -->
              <div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                      <h4 class="modal-title" id="addModalLabel">增加</h4>
                    </div>
                    <div class="modal-body">
                      <form id="addForm">
                                <div class="form-group">
                                  <label for="name">名称:</label>
                                  <input type="text" class="form-control" id="name_added" name="name" placeholder="名称">
                                </div>
                                <div class="form-group">
                                  <label for="longitude">联系人:</label>
                                  <input type="text" class="form-control" id="person_added" name="lng" placeholder="联系人">
                                </div>
                                <div class="form-group">
                                  <label for="latitude">手机号码:</label> 
                                  <input type="text" class="form-control" id="phone_added" name="lat" placeholder="手机号码">
                                </div>
                                <div class="form-group">
                                  <label for="latitude">座机号码:</label>
                                  <input type="text" class="form-control" id="mobile_added" name="lat" placeholder="座机号码">
                                </div>
                                <div class="form-group">
                                  <label for="latitude">邮箱地址:</label>
                                  <input type="text" class="form-control" id="email_added" name="lat" placeholder="邮箱地址">
                                </div>                                 
                      </form>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                      <button type="button" id="saveAdd" class="btn btn-primary">保存</button>
                    </div>
                  </div>
                </div>
              </div><!-- addModal -->

              <!-- setupModal -->
                      <div class="modal fade" id="setupModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                        <div class="modal-dialog" role="document">
                          <div class="modal-content">
                            <div class="modal-header">
                              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                              <h4 class="modal-title" id="setupModalLabel">设置</h4>
                            </div>
                            <div class="modal-body">
                              <form id="setupForm">
                                <div class="form-group">
                                  <label for="name">名称:</label>
                                  <input type="text" class="form-control" id="name_setup" name="name" placeholder="名称">
                                </div>
                                <div class="form-group">
                                  <label for="longitude">联系人:</label>
                                  <input type="text" class="form-control" id="person_setup" name="person" placeholder="联系人">
                                </div>
                                <div class="form-group">
                                  <label for="latitude">手机号码:</label> 
                                  <input type="text" class="form-control" id="phone_setup" name="phone" placeholder="手机号码">
                                </div>
                                <div class="form-group">
                                  <label for="latitude">座机号码:</label>
                                  <input type="text" class="form-control" id="mobile_setup" name="mobile" placeholder="座机号码">
                                </div>
                                <div class="form-group">
                                  <label for="latitude">邮箱地址:</label>
                                  <input type="text" class="form-control" id="email_setup" name="email" placeholder="邮箱地址">
                                </div>
                                 <input type="hidden" id="id_setup" name="id">                                  
                              </form>
                            </div>
                            <div class="modal-footer">
                              <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                              <button type="button" id="saveSetup" class="btn btn-primary">保存</button>
                            </div>
                          </div>
                        </div>
                      </div>
                      <!-- setupModal -->
             <!-- rmModal -->
                      <div class="modal fade" id="rmModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                        <div class="modal-dialog" role="document">
                          <div class="modal-content">
                            <div class="modal-header">
                              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                              <h4 class="modal-title" id="setupModalLabel">删除</h4>
                            </div>
                            <div class="modal-body">
                              <form id="rmForm">                                
                                <div class="form-group">
                                  <label for="rm">确定删除当前职能委办？</label>
                                  <input type="hidden" id="id_rm" name="id">   
                                </div>                                                              
                              </form>
                            </div>
                            <div class="modal-footer">
                              <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                              <button type="button" id="rm" class="btn btn-primary">确定</button>
                            </div>
                          </div>
                        </div>
                      </div>
                      <!-- rmModal -->
          </div>
      </div>
      </div>
{% end%}

{%block script%}
<script type="text/javascript">
    $('#setupModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget) 
        console.log(button)
        var id = button.data('id')
        var name = button.data('name')
        var person = button.data('person')
        var phone = button.data('phone')
        var mobile = button.data('mobile')
        var email = button.data('email')
        var modal = $(this)
        console.log(modal)
        modal.find('#id_setup').val(id)
        modal.find('#name_setup').val(name)
        modal.find('#person_setup').val(person)
        modal.find('#phone_setup').val(phone)
        modal.find('#mobile_setup').val(mobile)
        modal.find('#email_setup').val(email)
     }); 

    $('#rmModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget) 
        console.log(button)
        var id = button.data('id')
        var modal = $(this)
        console.log(modal)
        modal.find('#id_rm').val(id)
     });

    $('#saveSetup').click(function(){
        var id = $('#id_setup').val()
        var name = $('#name_setup').val()
        var person = $('#person_setup').val()
        var phone = $('#phone_setup').val()
        var mobile = $('#mobile_setup').val()
        var email = $('#email_setup').val()
        $('#saveSetup').html('保存中...')
        $.ajax({
            url: '/departments/setup',
            type: 'POST',
            data: {
               id:id,
               name:name,
               person:person,
               phone:phone,
               mobile:mobile,
               email:email
            },
            success:function(rt){
                  if(rt="success")location.reload();
            },
            error:function(){
            }
        })
    });

    $('#rm').click(function(){
        var id = $('#id_rm').val()
        $('#rm').html('删除中...')
        $.ajax({
            url: '/departments/remove',
            type: 'POST',
            data: {
               id:id
            },
            success:function(rt){
                  if(rt="success")location.reload();
            },
            error:function(){
            }
        })
    });

    $('#saveAdd').click(function(){
        var name = $('#name_added').val()
        var person = $('#person_added').val()
        var phone = $('#phone_added').val()
        var mobile = $('#mobile_added').val()
        var email = $('#email_added').val()
        
        $('#saveAdd').html('保存中...')
        $.ajax({
            url: '/departments/add',
            type: 'POST',
            data: {
               name:name,
               person:person,
               phone:phone,
               mobile:mobile,
               email:email
            },
            success:function(rt){
                  if(rt="success")location.reload();
            },
            error:function(){
            }
        })
    });


</script>
{%end%}